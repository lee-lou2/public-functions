<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
<!--    viewport-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¤ì›Œë“œ ê²€ìƒ‰</title>
    <style>
        .search {
          position: relative;
          width: 300px;
          display: flex;
          align-items: center;
          margin-left: auto;
          margin-right: auto;
        }

        input {
          width: 100%;
          border: 1px solid #bbb;
          border-radius: 8px;
          padding: 10px 12px;
          font-size: 14px;
        }

        img {
          position : absolute;
          width: 17px;
          top: 10px;
          right: 12px;
          margin: 0;
          cursor: pointer;
        }

        .result-list {
            margin-top: 10px;
            margin-left: auto;
            margin-right: auto;
            width: 280px;
            border: 1px solid #ddd; /* ë°•ìŠ¤ í…Œë‘ë¦¬ */
            padding: 10px;
            border-radius: 10px;
            display: none;
        }

        .result-item {
            padding: 5px;
            cursor: pointer;
        }

        .result-item.match {
            font-weight: bold; /* ì¼ì¹˜í•˜ëŠ” ê²€ìƒ‰ì–´ êµµê²Œ í‘œì‹œ */
        }


        .result-item:hover {
            background-color: #f6f6f6;
        }

        .custom-select {
            position: relative;
            display: inline-block;
            width: 200px;
            height: 35px;
            line-height: 35px;
            overflow: hidden;
            border-radius: 8px;
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            text-align: center;
            cursor: pointer;
            margin-right: 10px;
        }

        .custom-select select {
            width: 100%;
            height: 100%;
            line-height: 35px;
            border: none;
            outline: none;
            background: transparent;
            padding: 0 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .register-form {
            width: 500px;
            display: flex;
            align-items: center;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 50px;
        }

        button {
            /*ì˜ˆìœìƒ‰ìƒ ë°°ê²½*/
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-left: 10px;
            height: 35px;
            width: 120px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #45a049;
        }

        hr {
            width: 500px; /* ê°€ë¡œ ê¸¸ì´ ì„¤ì • */
            border: none; /* ê¸°ë³¸ í…Œë‘ë¦¬ ì œê±° */
            height: 1px; /* ì„ ì˜ ë‘ê»˜ */
            background-color: #d5d5d5; /* ì„ ì˜ ìƒ‰ìƒ */
            margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
            margin-bottom: 60px;
        }
    </style>
</head>
<body>
    <center>
        <h1>í‚¤ì›Œë“œ ë“±ë¡ í…ŒìŠ¤íŠ¸</h1>
        <div style="margin-bottom: 30px;color: gray">ì¶”ì²œì— ì‚¬ìš©ë  í‚¤ì›Œë“œë“¤ì„ ë“±ë¡í•´ì£¼ì„¸ìš”<br>ì™¼ìª½ ì…€ë ‰íŠ¸ë°•ìŠ¤ëŠ” 'í‚¤ì›Œë“œ íƒ€ì…'ìœ¼ë¡œ ì‚¬ìš©ë  ì˜ˆì •ì…ë‹ˆë‹¤ (ê²€ìƒ‰ì˜ ì •í™•ë„ì™€ ë‹¤ì–‘ì„±ì„ ë†’ì´ê¸° ìœ„í•¨)</div>
    </center>
    <div class="register-form">
        <div class="custom-select">
            <select id="keyword-type">
                <option value="ğŸ‘©â€âš•ï¸">ì˜ì‚¬</option>
                <option value="ğŸ¥">ë³‘ì›</option>
                <option value="ğŸ©º">ì§„ë£Œ ê³¼ëª©</option>
            </select>
        </div>
        <input id="keyword-input" type="text" placeholder="í‚¤ì›Œë“œ ì…ë ¥">
        <button id="register-button">ë“±ë¡</button>
    </div>
    <hr>
    <center>
        <h1>í‚¤ì›Œë“œ ì¶”ì²œ</h1>
        <div style="margin-bottom: 30px;color: gray">í…ìŠ¤íŠ¸ ì…ë ¥ì‹œ ì…ë ¥í•œ í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ í‚¤ì›Œë“œê°€ ìë™ìœ¼ë¡œ ì¶”ì²œë©ë‹ˆë‹¤</div>
    </center>
    <div class="search">
        <input id="search-input" type="text" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
        <a id="search-button"><img src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png"></a>
    </div>
    <div id="result-list" class="result-list"></div>
    <div id="search-results" class="search-results" style="margin-top: 20px"></div>

    <script>
        let searchType = '';
        // ë“±ë¡ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('register-button').addEventListener('click', function() {
            var keywordType = document.getElementById('keyword-type').value;
            var keyword = document.getElementById('keyword-input').value;

            var data = {
                keyword_type: keywordType,
                keyword: keyword
            };

            fetch('/keywords/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => response.json())
              .then(data => {
                  console.log('Success:', data);
                  document.getElementById('keyword-input').value = '';
                  alert('ì„±ê³µ');
              })
              .catch((error) => {
                  console.error('Error:', error);
              });
        });

        document.getElementById('search-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('search-button').click();
            }
        });

        document.getElementById('search-input').addEventListener('input', function(e) {
            var query = e.target.value;
            var resultList = document.getElementById('result-list');
            if (query.length > 0) {
                fetch(`/keywords/?q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => displayResults(data));
            } else {
                resultList.innerHTML = '';
                resultList.style.display = 'none'; // ê²€ìƒ‰ì°½ì´ ë¹„ì–´ìˆì„ ë•Œ ë°•ìŠ¤ ìˆ¨ê¹€
            }
        });

        document.getElementById('search-button').addEventListener('click', function() {
            var resultList = document.getElementById('result-list');
            resultList.innerHTML = '';
            resultList.style.display = 'none'; // ê²€ìƒ‰ì°½ì´ ë¹„ì–´ìˆì„ ë•Œ ë°•ìŠ¤ ìˆ¨ê¹€
            var query = document.getElementById('search-input').value;
            var searchResults = document.getElementById('search-results');
            if (searchType === '') {
                searchResults.innerHTML = '<center>í‚¤ì›Œë“œ íƒ€ì…ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>- í‚¤ì›Œë“œ íƒ€ì… : ' + query + '</center>';
            } else {
                searchResults.innerHTML = '<center>' + searchType + ' íƒ€ì…ìœ¼ë¡œ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.<br>- ì…ë ¥ëœ ê²€ìƒ‰ì–´ : ' + query + '</center>';
            }
            // fetch(`/search?q=${encodeURIComponent(query)}`)
            //     .then(response => response.json())
            //     .then(data => displaySearchResults(data));
        });

        function displayResults(data) {
            var resultList = document.getElementById('result-list');
            var query = document.getElementById('search-input').value.toLowerCase();
            resultList.innerHTML = '';

            // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
            if (data.length === 0) {
                resultList.style.display = 'none';
            } else {
                resultList.style.display = 'block'; // ë˜ëŠ” 'flex' ë“± ì›í•˜ëŠ” ìŠ¤íƒ€ì¼

                data.forEach(hit => {
                    var keyword = hit._source.keyword_type + ' ' + hit._source.keyword;
                    var div = document.createElement('div');
                    div.className = 'result-item';

                    // í‚¤ì›Œë“œì— ê²€ìƒ‰ì–´ ë¶€ë¶„ì„ êµµê²Œ í‘œì‹œ
                    var highlightedText = keyword.replace(new RegExp(query, "gi"), (match) => `<strong>${match}</strong>`);
                    div.innerHTML = highlightedText;

                    div.addEventListener('click', function() {
                        searchType = hit._source.keyword_type;
                        document.getElementById('search-input').value = hit._source.keyword;
                        document.getElementById('search-button').click();
                        resultList.innerHTML = '';
                        resultList.style.display = 'none';
                    });

                    resultList.appendChild(div);
                });
            }
        }



        function displaySearchResults(data) {
            var searchResults = document.getElementById('search-results');
            searchResults.innerHTML = '';
            // ì—¬ê¸°ì— ê²€ìƒ‰ ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
            // ì˜ˆ: data['doctor']['name'], data['hospital']['name'] ë“±ì„ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ í‘œì‹œ
        }

    </script>
</body>
</html>
